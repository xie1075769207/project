"use strict";var container=document.querySelector(".container"),login=getCookie("login");function render(t){var e,n,a;t.length?(e=t.every(function(t){return 1==t.is_select}),n=shopNum(t),a='<div class="panel panel-default">\n    <div class="panel-heading">\n        <div class="content">\n            <label for="" class="checkbox">\n                <input type="checkbox" id="all" '.concat(e?"checked":"",'>\n                <span>全选</span>\n            </label>\n            <label for="" class="type">\n                <span>商品种类：</span>\n                <span>').concat(t.length,'</span>\n            </label>\n            <label for="" class="qty">\n                <span>所选商品数量：</span>                \n                <span>').concat(n.totalNum,'</span>\n            </label>\n            <label for="" class="price">\n                <span>所选商品价格：</span>\n                <span id="commodityPrices">').concat(n.totalPrice,'</span>\n            </label>\n            <label for="">\n                <button class="btn btn-warning btn-xs" id="settlement">结算</button>\n                <button class="btn btn-info btn-xs" id="clear">清空购物车</button>\n            </label>\n        </div>\n    </div>'),a+='<div class="panel-body"><ul>',t.forEach(function(t){a+=' <li>\n        <div class="media">\n            <div class="media-left media-middle">\n                <input type="checkbox" class="check" '.concat(1==t.is_select?"checked":"",' goods_id="').concat(t.goods_id,'">\n                <a href="#">\n                    <img class="media-object"\n                        src="').concat(t.goods_small_logo,'"\n                        alt="">\n                </a>\n            </div>\n            <div class="media-body">\n                <h4 class="media-heading">').concat(t.goods_name,'</h4>\n                <div class="price">\n                    <i class="glyphicon glyphicon-yen"></i>\n                    <span>').concat(t.goods_price,'</span>\n                </div>\n                <div class="btn">\n                    <p>\n                        <butto class="btn btn-danger del" goods_id="').concat(t.goods_id,'">删除商品</butto>\n                    </p>\n                    <div class="btn-group" role="group" goods_id="').concat(t.goods_id,'" aria-label="..."> \n                        <button class="btn btn-default reduce">-</button>\n                        <button class="btn btn-default" id="goods_num">').concat(t.cart_number,'</button>\n                        <button class="btn btn-default add">+</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </li>')}),a+=" </ul></div></div>",container.innerHTML=a):container.innerHTML='<div class="jumbotron">\n        <h1>亲爱的用户</h1>\n        <p>您购物车空空如也,请到商城首页选购你的商品</p>\n        <p><a class="btn btn-primary btn-lg" href="../html/index.html" role="button">点击去到商城界面</a></p>\n        </div>'}function shopNum(t){var e=t.filter(function(t){return 1==t.is_select});return{totalNum:e.reduce(function(t,e){return t+ +e.cart_number},0),totalPrice:e.reduce(function(t,e){return t+e.goods_price*e.cart_number},0).toFixed(2)}}login||(location.href="../html/login.html",localStorage.setItem("url","http://gz2008.com/project/html/car.html")),pAjax({url:"../api/getCarData.php",data:{username:login}}).then(function(t){localStorage.setItem("goodsList",JSON.stringify(JSON.parse(t))),render(JSON.parse(t))}),container.onclick=function(){var t,e,n,a,o,s,i,r,c,l=window.event;"all"==l.target.id&&((t=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){l.target.checked?t.is_select=1:t.is_select=0}),localStorage.setItem("goodsList",JSON.stringify(t)),render(t)),"check"==l.target.className&&(e=l.target.getAttribute("goods_id"),(n=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){t.goods_id==e&&(t.is_select=l.target.checked?1:0)}),localStorage.setItem("goodsList",JSON.stringify(n)),render(n)),l.target.classList.contains("del")&&(a=l.target.getAttribute("goods_id"),pAjax({url:"../api/removeCarData.php",data:{username:login,goods_id:a}}).then(function(t){var e;JSON.parse(t).code&&(e=JSON.parse(localStorage.getItem("goodsList")).filter(function(t){return t.goods_id!=a}),localStorage.setItem("goodsList",JSON.stringify(e)),render(e))})),l.target.classList.contains("reduce")&&(o=l.target.parentNode.getAttribute("goods_id"),(s=l.target.nextElementSibling.innerHTML-1)<=1&&(s=1),pAjax({url:"../api/updCarData.php",data:{username:login,goods_id:o,goods_num:s}}).then(function(t){var e;JSON.parse(t).code&&((e=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){t.goods_id===o&&(t.cart_number=s)}),render(e),localStorage.setItem("goodsList",JSON.stringify(e)))})),l.target.classList.contains("add")&&(i=l.target.parentNode.getAttribute("goods_id"),r=+l.target.previousElementSibling.innerHTML+1,pAjax({url:"../api/updCarData.php",data:{username:login,goods_id:i,goods_num:r}}).then(function(t){var e;JSON.parse(t).code&&((e=JSON.parse(localStorage.getItem("goodsList"))).forEach(function(t){t.goods_id===i&&(t.cart_number=r)}),render(e),localStorage.setItem("goodsList",JSON.stringify(e)))})),"clear"==l.target.id&&pAjax({url:"../api/clearCarData.php",data:{username:login}}).then(function(t){JSON.parse(t)&&(localStorage.removeItem("goodsList"),render([]))}),"settlement"==l.target.id&&(c=document.querySelector("#commodityPrices"),alert("您购买的商品总价格为:"+c.innerHTML))};